<!DOCTYPE html>
<html>
<head>
    <title>2nd viewport demo app</title>
    <style>
        body { margin: 0; }
        canvas { width: 100%; height: 100% }
    </style>
</head>
<body>

    <div id="main" style="position: absolute; left:0px; top:0px"></div>
    <div id="small" style="position: absolute; left:0px; top: 75%">
        <div id="left" style="position: absolute; left:0px; top: 0px"></div>
        <div id="right" style="position: absolute; left:50%; top: 0px"></div>
    </div>
    <script src='threeJS/three.js'></script>
    <script src='threeJS/OrbitControls.js'></script>
    <script src='threeJS/OBJLoader.js'></script>
	<script src='threeJS/OBJMTLLoader.js'></script>
	<script src='threeJS/MTLLoader.js'></script>
    <script type="text/javascript" src="threeJS/dat.gui.js"></script>
    <script src='./objects.js'></script>
    <script src='./controls.js'></script>
    <script type="text/javascript">

        var scene1, scene2, camera1, camera2, renderer1, renderer2;
        var geometry, material, mesh;
        var topp = new THREE.Object3D();
        var motherboard = new THREE.Object3D();
        var cpu = new THREE.Object3D();
        var gpu = new THREE.Object3D();
        var ram = new THREE.Object3D();
        var ssd = new THREE.Object3D();
        var battery = new THREE.Object3D();
        var dvd = new THREE.Object3D();
        var bus = new THREE.Object3D();
        var bottom = new THREE.Object3D();
        var gui = new THREE.Object3D();
        var laptopFull = new THREE.Object3D();
        var controls;

        gui = new dat.GUI();

        init();
        setupGui();
        animate();

        function threePointLight() {
			var x;
			var y;
			var z;
			x = y = z = 3;
			var intense =.5;
			var color = 0xffffff;

            var directionalLight = new THREE.DirectionalLight( color );
            directionalLight.position.set(x, y, z).normalize();
            directionalLight.intensity = intense;
            scene1.add( directionalLight );//top
            //scene2.add( directionalLight );

            directionalLight = new THREE.DirectionalLight( color );
            directionalLight.position.set(-x, -y, -z).normalize();
            directionalLight.intensity = intense;
            scene1.add(directionalLight);//bottom

            directionalLight = new THREE.DirectionalLight(color);
            directionalLight.position.set(-x, 0, 0).normalize();
            directionalLight.intensity = intense;
            scene1.add(directionalLight); //left

			directionalLight = new THREE.DirectionalLight(color);
            directionalLight.position.set(x, 0, 0).normalize();
            directionalLight.intensity = intense;
            scene1.add(directionalLight); //right

			var light = new THREE.HemisphereLight( color, 0x000000, intense );
			scene1.add( light );
            //scene2.add( light.clone() );
        }
        function loadObject() {
            topp = LoadTop(1,0,-.5);
            motherboard = LoadMotherboard(.505,0,0);
            cpu = LoadCPU(.85,0,-.25);
            gpu = LoadGPU(.85,0,-2.25);
            ram = LoadRAM(.25,0,-.25);
            ssd = LoadSSD(.4,0,0);
            battery = LoadBattery(.45,0,-.1);
            dvd = LoadDVD(.4,90,-.15);
            //bus = LoadBus(1,0,1);
            //bottom = LoadBottom(1,0,-2);
            laptopFull.add(topp,motherboard,cpu,gpu,ram,ssd,battery,dvd/*,bus,bottom*/);
            laptopFull.rotation.y = Math.PI / 2;
			laptopFull.position.y = -2;
            scene1.add(laptopFull);
        }

        function init() {

            scene1 = new THREE.Scene();

            camera1 = new THREE.PerspectiveCamera( 75, window.innerWidth / (window.innerHeight - window.innerHeight / 4), 1, 10000 );
            camera1.position.z = -30;
			camera1.position.y = 5;

            loadObject();
            threePointLight();

            renderer1 = new THREE.WebGLRenderer({ antialias: true, alpha: true, premultipliedAlpha: true} );
            renderer1.shadowMap.enabled = true;
			renderer1.setClearColor( 0xb2b2b2, 1 );
            renderer1.setPixelRatio( window.devicePixelRatio );
            renderer1.setSize( window.innerWidth, window.innerHeight - window.innerHeight / 3 );

            // Add OrbitControls so that we can pan around with the mouse.
            controls = new THREE.OrbitControls(camera1, renderer1.domElement);
            controls.target.set(0,0,0);
            document.body.appendChild( renderer1.domElement );
            
            scene2 = new THREE.Scene();
            
            camera2 = new THREE.PerspectiveCamera( 75, (window.innerWidth / 2) / (window.innerHeight / 3), 1, 4000 );
            camera2.position.z = -30;
            camera2.position.y = 5;
            camera2.lookAt( ssd.position);
            
            scene2.add(ssd.clone());
            
            renderer2 = new THREE.WebGLRenderer({ antialias: true, alpha: true, premultipliedAlpha: true} );
            renderer2.shadowMap.enabled = true;
            renderer2.setClearColor(0xb2b2b2, 1);
            renderer2.setSize( window.innerWidth / 2, window.innerHeight / 3 );
            document.body.appendChild( renderer2.domElement );
        }
        
      function setupGui() {
        effectController = {
              fieldOfView:40
          };
        controls = new function() {
            this.rotation = 0;
            this.expand = 0;
            //this.zoom = 0;
            this.reset = false;//function() { ); };
        }  
       //controls.reset.onclick(expand(0));
        //var element = 
        gui.add(effectController, "fieldOfView", 1.0, 179.0);
        gui.add(controls, 'rotation', 0.0, 10.0);
        gui.add(controls, 'expand', 0, 5);
        gui.add(controls, 'reset');   
        //element.name("field of view");
         
    }
		// This function is called many times a second.  You do anything that
		// needs to be updated, changed, moved here
	function animate() {

		requestAnimationFrame( animate );
        
        expand(controls.expand);
        if(controls.reset == true)
            {
                expand(0);
                rotate(0);
                controls.reset = false;
                controls.expand = 0;
                controls.rotation = 0;
                
            }
        rotate(controls.rotation);
        
        // field of view controller updater
        camera1.fov = effectController.fieldOfView;
        camera1.updateProjectionMatrix();
        
        camera2.updateProjectionMatrix();
        
        
		// must do these two statements
		renderer1.render( scene1, camera1 ); 
        renderer2.render( scene2, camera2 );
		//controls.update();

	}
  </script>
</body>
</html>
